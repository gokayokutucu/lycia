<Project Sdk="Microsoft.NET.Sdk">

    <PropertyGroup>
        <TargetFrameworks>netstandard2.0;net8.0;net9.0</TargetFrameworks>
        <LangVersion>preview</LangVersion>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <SuppressProjectReferenceDependenciesWhenPacking>true</SuppressProjectReferenceDependenciesWhenPacking>
    </PropertyGroup>

    <PropertyGroup>
        <Authors>M. Gokay Okutucu</Authors>
        <Description>Lycia.Extensions provides pluggable modules and integrations for the Lycia Saga framework.
            It offers ready-to-use extensions for configuration, middleware, retry, scheduling, and observability:
            - Fluent DI registration (AddLycia with ConfigureSaga, ConfigureEventBus, ConfigureRetry, ConfigureScheduling)
            - Built-in retry policies with Polly integration
            - Configurable middleware slots (logging, retry, custom middlewares)
            - Health check integration (IHealthCheck)
            - Scheduling extensions with Redis-based storage

            Keep your Saga setup modular, extensible, and production-grade. Add only the components you need.
        </Description>
        <Copyright>Copyright (c) 2025 M. Gokay Okutucu</Copyright>
        <PackageProjectUrl>https://github.com/gokayokutucu/lycia</PackageProjectUrl>
        <PackageLicenseExpression>Apache-2.0</PackageLicenseExpression>
        <RepositoryUrl>https://github.com/gokayokutucu/lycia</RepositoryUrl>
        <RepositoryType>git</RepositoryType>
        <PackageTags>saga distributed-transaction workflow orchestration choreography idempotency retry timeout compensation middleware rabbitmq redis microservices event-driven</PackageTags>
    </PropertyGroup>

	<!--<PropertyGroup>
		<GenerateReferenceAssembly>false</GenerateReferenceAssembly>
		<GeneratePackageOnBuild>true</GeneratePackageOnBuild>
		<PackageId>Lycia.Extensions</PackageId>
		<Version>1.0.0</Version>
		<Authors>gokay.okutucu</Authors>
		<Company>PeopleCert</Company>
		<Description>Internal messaging extensions library for PeopleCert projects</Description>
		<PackageTags>messaging internal</PackageTags>
		<RepositoryUrl>https://github.com/gokayokutucu/lycia.git</RepositoryUrl>
	</PropertyGroup>-->

	<!--<Target Name="PublishNupkgToShare" AfterTargets="Pack">
		<ItemGroup>
			<_Nupkg Include="$(PackageOutputPath)\$(PackageId).$(Version).nupkg" />
		</ItemGroup>
		<Copy SourceFiles="@(_Nupkg)" DestinationFolder="\\if-srv-nas\R&amp;D_Files\PASSPORT\gkuvandik\nuget-packages" SkipUnchangedFiles="true" Condition="Exists('%(Identity)')" />
	</Target>-->

	<!-- netstandard2.0 -->
	<ItemGroup Condition="'$(TargetFramework)' == 'netstandard2.0'">
		<PackageReference Include="RabbitMQ.Client" Version="6.2.1" />
		<PackageReference Include="StackExchange.Redis" Version="2.0.601" />
		<PackageReference Include="System.IO.Pipelines" Version="5.0.1" />
		<PackageReference Include="System.Runtime.CompilerServices.Unsafe" Version="6.0.0" />
		<PackageReference Include="Microsoft.Bcl.AsyncInterfaces" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Logging" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Options.ConfigurationExtensions" Version="6.0.0" />
		<PackageReference Include="Microsoft.Extensions.Primitives" Version="6.0.0" />
	</ItemGroup>

	<!-- net8.0 -->
	<ItemGroup Condition="'$(TargetFramework)' == 'net8.0'">
		<PackageReference Include="RabbitMQ.Client" Version="7.1.2" />
		<PackageReference Include="StackExchange.Redis" Version="2.8.41" />
		<PackageReference Include="System.IO.Pipelines" Version="8.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration" Version="8.0.0" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="8.0.0" />
		<PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" Version="8.0.2" />
		<PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks" Version="8.0.0" />
		<PackageReference Include="Microsoft.Extensions.Logging" Version="8.0.0" />
		<PackageReference Include="Microsoft.Extensions.Options.ConfigurationExtensions" Version="8.0.0" />
		<PackageReference Include="Microsoft.Extensions.Primitives" Version="8.0.0" />
	</ItemGroup>

	<!-- net9.0 (preview) -->
	<ItemGroup Condition="'$(TargetFramework)' == 'net9.0'">
		<PackageReference Include="RabbitMQ.Client" Version="7.1.2" />
		<PackageReference Include="StackExchange.Redis" Version="2.8.41" />
		<PackageReference Include="System.IO.Pipelines" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.Configuration" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.Configuration.Binder" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.DependencyInjection.Abstractions" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.Diagnostics.HealthChecks" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.Logging" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.Options.ConfigurationExtensions" Version="9.0.9" />
		<PackageReference Include="Microsoft.Extensions.Primitives" Version="9.0.9" />
	</ItemGroup>

	<ItemGroup>
		<PackageReference Include="Apache.Avro" Version="1.12.0" />
		<PackageReference Include="Autofac" Version="7.1.0" />
		<PackageReference Include="Autofac.Extensions.DependencyInjection" Version="8.0.0" />
		<PackageReference Include="Autofac.WebApi2" Version="6.1.1" />
		<PackageReference Include="Microsoft.CSharp" Version="4.7.0" />
		<PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
		<PackageReference Include="Pipelines.Sockets.Unofficial" Version="2.2.8" />
		<PackageReference Include="Polly" Version="8.6.3" />
		<PackageReference Include="Serilog" Version="4.3.0" />
	</ItemGroup>

    <!-- Can stay for local build -->
    <PropertyGroup>
        <UsePackageRefForLyciaOnPack>false</UsePackageRefForLyciaOnPack>
    </PropertyGroup>
    
    <ItemGroup Condition="'$(UsePackageRefForLyciaOnPack)' != 'true'">
        <ProjectReference Include="..\Lycia\Lycia.csproj" />
    </ItemGroup>

    <ItemGroup Condition="'$(UsePackageRefForLyciaOnPack)' == 'true'">
        <PackageReference Include="Lycia" Version="[1.17.0-beta, 1.18.0)" />
        <ProjectReference Remove="..\Lycia\Lycia.csproj" />
    </ItemGroup>
    
    <ItemGroup>
        <!-- Only if required, but don't let it leak into the package order -->
        <ProjectReference Include="..\Lycia.Infrastructure\Lycia.Infrastructure.csproj" PrivateAssets="All" />
        <ProjectReference Include="..\Lycia.Messaging\Lycia.Messaging.csproj" PrivateAssets="All" />
    </ItemGroup>

  <!-- Remove Infrastructure ProjectReference when packing -->
    <Target Name="RemoveInfraProjectRefForPack" BeforeTargets="PrepareForPack">
        <ItemGroup>
            <ProjectReference Remove="..\Lycia.Infrastructure\Lycia.Infrastructure.csproj" />
            <ProjectReference Remove="..\Lycia.Messaging\Lycia.Messaging.csproj" />
        </ItemGroup>
    </Target>

    <ItemGroup>
        <Folder Include="Retry\"/>
    </ItemGroup>

</Project>
